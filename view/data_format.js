let data = [
  {
    id: "mark.otto@mdo.com",
    first: "Mark",
    last: "Otto",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "jean.puigrenier@test.com",
    first: "Jean",
    last: "Puipui",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "kahina.test@kahina.fr",
    first: "Paulina",
    last: "Kahina",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "michel.dupont@hotmail.fr",
    first: "Michel",
    last: "Dupont",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-1@gmail.com",
    first: "Benoît",
    last: "Hamont",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-2@gmail.com",
    first: "Gérard",
    last: "Pichard",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-3@gmail.com",
    first: "Benjamin",
    last: "Castaldi",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-4@gmail.com",
    first: "Christina",
    last: "Cordoula",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-5@gmail.com",
    first: "Jean-Marc",
    last: "Herault",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-6@gmail.com",
    first: "Juliette",
    last: "Binoche",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-7@gmail.com",
    first: "Mélanie",
    last: "Laurent",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-8@gmail.com",
    first: "Laurent",
    last: "Lafitte",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-9@gmail.com",
    first: "Laurent",
    last: "Baffie",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
  {
    id: "test-10@gmail.com",
    first: "Paul",
    last: "Veroven",
    phone: "0145879020",
    pwd: "mot de passe",
    date: "2021/01/01",
    time: "14:24",
    contact1: { first: "Gérard", last: "Lupin", phone: "+43788990010" },
    contact2: { first: "Bernard", last: "Sanders", phone: "+11233445566" },
    contact3: { first: "Paul", last: "Lee", phone: "+33612171518" },
    record: "./test.mp3",
    location: { lat: 45.868804, long: 1.268911 },
  },
];
let sizePerPage = 5;
let page = 1;

function getTableContent() {
  function formatReceivedData(array) {
    return array.map((item, index) => {
      return (
        "<tr>\n" +
        "<td>\n" +
        "<input id='checkbox-" +
        (index + 1) +
        "' type='checkbox' onchange='selectRow(" +
        (index + 1) +
        ")'>" +
        "</td>\n" +
        "<th scope='row'>" +
        (index + 1) +
        "</th> \n" +
        "<td class='cell-id'>" +
        item.id +
        "</td>\n" +
        "<td class='cell-phone'>" +
        item.date +
        " " +
        item.time +
        "</td>\n" +
        "<td class='cell-phone'>" +
        item.phone +
        "</td>\n" +
        "<td>" +
        `<audio controls><source src="${item.record}" type="audio/mp3"></audio>` +
        `<a id="record-${index}" href="${item.record}" download> Download &darr; </a> </td>\n` +
        "<td>" +
        "<span>" +
        item.location.lat +
        " , " +
        item.location.long +
        "</span>" +
        "</td>\n" +
        "<td>" +
        item.first +
        "</td>\n" +
        "<td>" +
        item.last +
        "</td>\n" +
        "<td>" +
        item.contact1.first +
        "</td>\n" +
        "<td>" +
        item.contact1.last +
        "</td>\n" +
        "<td>" +
        item.contact1.phone +
        "</td>\n" +
        "<td>" +
        item.contact2.first +
        "</td>\n" +
        "<td>" +
        item.contact2.last +
        "</td>\n" +
        "<td>" +
        item.contact2.phone +
        "</td>\n" +
        "<td>" +
        item.contact3.first +
        "</td>\n" +
        "<td>" +
        item.contact3.last +
        "</td>\n" +
        "<td>" +
        item.contact3.phone +
        "</td>\n" +
        "<td>" +
        item.pwd +
        "</td>\n" +
        "</tr>\n"
      );
    });
  }
  $("#table_content").empty();
  $("#pages").empty();
  let content = formatReceivedData(data);
  let numberPages = Math.ceil(data.length / sizePerPage); //Math.ceil retourne le plus petit entier supérieur de l'argument . Exemple : 3 paghes pour 13 données avec 5 données par pages
  let shownContent = content.slice(0, 5);

  for (let i = 0; i < numberPages; i++) {
    let active = i === 0 ? "btn btn-primary active" : "btn"; // attribution confitionnelle variable. pseudo-code let x = condition ? si oui : si non
    $("#pages").append(
      `<button class="${active}" id="page-${i + 1}">${i + 1}</button>`
    );
    $(`#page-${i + 1}`).click(function () {
      page = i + 1;
      $("#table_content").empty();
      $("#table_content").append(content.slice(i * 5, (i + 1) * 5).join("\n")); // joint les valeurs d'une liste avec l'argument entre, ici un saut de ligne
      $(".btn-primary.active").removeClass("btn-primary active");
    });
    $(`#page-${i + 1}`).addClass("btn-primary active");
  }
  $("#data_table").append(shownContent.join("\n"));
}

$(document).ready(function () {
  getTableContent();
});

let selectedRows = [];

function selectAll() {
  let allChecked = $("#selectAllBox").prop("checked");
  for (let i = 1; i <= 5; i++) {
    $("#checkbox-" + i).prop("checked", allChecked);
  }
  selectedRows = Array.from({ length: sizePerPage }, (v, k) => k * page + 1);
  $("#delete_button").prop("disabled", false);
}

function selectRow(index) {
  let rowChecked = $("#checkbox-" + index).prop("checked");
  if (rowChecked) {
    $("#selectAllBox").prop("checked", true);
    $("#delete_button").prop("disabled", false);
    selectedRows.push(index);
  } else {
    if (selectedRows.length > 0) {
      let rowIndexInSelected = selectedRows.findIndex(
        (element) => element === index
      );
      selectedRows.splice(rowIndexInSelected, 1);
    } else {
      selectedRows = [];
    }
    if (selectedRows.length === 0) {
      $("#selectAllBox").prop("checked", false);
      $("#delete_button").prop("disabled", true);
    }
  }
}

function deleteRows() {
  let orderedIndexes = selectedRows.sort();
  for (let i = 0; i < orderedIndexes.length; i++) {
    let rowIndex = orderedIndexes[i] - 1;
    if (data.length > 0) {
      let rowIndexIndata = data.findIndex(
        (element, index) => index === rowIndex - 1
      );
      // splice(0,1) ne marche pas donc on utilise la fonction shift
      if (rowIndexIndata === 0) {
        data.shift();
      } else {
        //retire l'élement rowIndexIndata
        data.splice(rowIndexIndata, 1);
      }
    } else {
      data = [];
    }
  }

  selectedRows = [];
  $("#selectAllBox").prop("checked", false);
  getTableContent();
}
